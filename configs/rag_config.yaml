# RAG Configuration
# Defines retrieval and indexing settings

# Embedding settings
embeddings:
  model: text-embedding-3-small
  provider: openai
  dimensions: 1536
  batch_size: 100
  
  # Fallback for offline mode
  fallback:
    provider: sentence_transformers
    model: all-MiniLM-L6-v2
    dimensions: 384

# Chunking settings
chunking:
  default_strategy: recursive
  
  strategies:
    recursive:
      chunk_size: 1000
      chunk_overlap: 200
      separators:
        - "\n\n"
        - "\n"
        - ". "
        - " "
        - ""
    
    semantic:
      chunk_size: 1500
      chunk_overlap: 300
      similarity_threshold: 0.7
      min_chunk_size: 100
      
    fixed:
      chunk_size: 500
      chunk_overlap: 50

# Vector store settings
vector_store:
  provider: faiss
  index_type: IVF_FLAT
  nlist: 100  # Number of clusters for IVF
  
  # Persistence
  persist_directory: ./data/vector_store
  auto_save: true
  save_interval: 300  # seconds
  
  # Alternative: Pinecone
  # provider: pinecone
  # index_name: aegis-rag
  # namespace: default

# Retrieval settings
retrieval:
  # Default settings
  top_k: 5
  similarity_threshold: 0.7
  
  # Hybrid search
  hybrid:
    enabled: true
    keyword_weight: 0.3
    semantic_weight: 0.7
    fusion_method: rrf  # reciprocal rank fusion
    rrf_k: 60
  
  # Reranking
  reranking:
    enabled: true
    model: cross-encoder/ms-marco-MiniLM-L-6-v2
    top_k_rerank: 3
    score_threshold: 0.5
    
  # Contextual compression
  compression:
    enabled: false
    max_tokens_per_chunk: 300

# Domain configurations
domains:
  technical_support:
    chunking_strategy: recursive
    chunk_size: 800
    top_k: 7
    similarity_threshold: 0.65
    hybrid_enabled: true
    reranking_enabled: true
    
  financial_analysis:
    chunking_strategy: semantic
    chunk_size: 1200
    top_k: 5
    similarity_threshold: 0.75
    hybrid_enabled: true
    reranking_enabled: true
    
  general_chat:
    chunking_strategy: recursive
    chunk_size: 1000
    top_k: 3
    similarity_threshold: 0.6
    hybrid_enabled: false
    reranking_enabled: false

# Ingestion settings
ingestion:
  # Supported file types
  supported_types:
    - .txt
    - .md
    - .pdf
    - .docx
    - .html
    
  # Document processing
  max_document_size: 10485760  # 10MB
  parallel_workers: 4
  
  # Metadata extraction
  extract_metadata: true
  metadata_fields:
    - title
    - author
    - created_date
    - source

# Caching
cache:
  enabled: true
  ttl: 3600  # seconds
  max_size: 1000  # entries
  
  # Query cache
  query_cache:
    enabled: true
    ttl: 300

# Monitoring
monitoring:
  track_retrievals: true
  track_latency: true
  sample_rate: 1.0
